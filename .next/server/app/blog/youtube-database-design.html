<!DOCTYPE html><html lang="en-us" class="__variable_587f35 scroll-smooth"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="font" href="/_next/static/media/2d141e1a38819612-s.p.woff2" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/static/images/loctruong/Conmeokhum.gif"/><link rel="preload" as="image" href="images/hld_youtube.png"/><link rel="preload" as="image" href="images/detailed_design_youtube.png"/><link rel="stylesheet" href="/_next/static/css/b81ce051c4701a02.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/5abd8ff7b69db80c.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/72575e3a678ba3db.css" data-precedence="next"/><link rel="preload" href="/_next/static/chunks/webpack-0d790ec478344941.js" as="script" fetchPriority="low"/><script src="/_next/static/chunks/fd9d1056-5e8da0e061142b95.js" async=""></script><script src="/_next/static/chunks/596-a658b434dadd6520.js" async=""></script><script src="/_next/static/chunks/main-app-66f70c86476f9066.js" async=""></script><link rel="preload" as="script" href="https://analytics.umami.is/script.js"/><title>Youtube database design | Portfolio &amp; Blog</title><meta name="description" content="Ddesign a video sharing service like Youtube where users will be able to upload/view/search videos."/><meta name="robots" content="index, follow"/><meta name="googlebot" content="index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1"/><link rel="canonical" href="https://tailwind-nextjs-starter-blog.vercel.app/blog/youtube-database-design"/><link rel="alternate" type="application/rss+xml" href="https://tailwind-nextjs-starter-blog.vercel.app/feed.xml"/><meta property="og:title" content="Youtube database design"/><meta property="og:description" content="Ddesign a video sharing service like Youtube where users will be able to upload/view/search videos."/><meta property="og:url" content="https://tailwind-nextjs-starter-blog.vercel.app/blog/youtube-database-design"/><meta property="og:site_name" content="Portfolio &amp; Blog"/><meta property="og:locale" content="en_US"/><meta property="og:image" content="https://tailwind-nextjs-starter-blog.vercel.app/static/images/twitter-card.png"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2024-04-20T00:00:00.000Z"/><meta property="article:modified_time" content="2024-04-20T00:00:00.000Z"/><meta property="article:author" content="Loc Truong"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Youtube database design"/><meta name="twitter:description" content="Ddesign a video sharing service like Youtube where users will be able to upload/view/search videos."/><meta name="twitter:image" content="https://tailwind-nextjs-starter-blog.vercel.app/static/images/twitter-card.png"/><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="76x76" href="/static/favicons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png"/><link rel="manifest" href="/static/favicons/site.webmanifest"/><link rel="mask-icon" href="/static/favicons/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#000000"/><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"/><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="bg-white text-black antialiased dark:bg-gray-950 dark:text-white"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><section><div class="mx-auto max-w-3xl px-4 sm:px-6 xl:max-w-5xl xl:px-0"><div class="flex h-screen flex-col justify-between font-sans"><header class="flex items-center justify-between py-10 custom-header"><div><a aria-label="Loc Truong" href="/"><div class="flex items-center justify-between"><div class="mr-3"><svg width="90" height="20" viewBox="0 0 160 69.55665699462354" class="looka-1j8o68f"><defs id="SvgjsDefs1242"></defs><g id="SvgjsG1243" transform="matrix(0.5628253254220374,0,0,0.5628253254220374,-5.327141790999914,9.766146226504215)" fill="#1a2c5b"><polygon xmlns="http://www.w3.org/2000/svg" points="38.182,57.753 20.18,47.91 20.18,42.455 38.182,32.652 38.182,39.074 25.625,45.113 38.182,51.379 "></polygon><polygon xmlns="http://www.w3.org/2000/svg" points="39.848,62.08 46.351,27.918 50.136,27.918 43.56,62.08 "></polygon><polygon xmlns="http://www.w3.org/2000/svg" points="51.8,57.78 51.8,51.4 64.372,45.181 51.8,39.028 51.8,32.696 69.82,42.5 69.82,47.91 "></polygon><path xmlns="http://www.w3.org/2000/svg" d="M44.999,86.031L9.465,65.517V24.484L44.999,3.969l35.536,20.516v41.029L44.999,86.031L44.999,86.031z M13.07,63.434  l31.929,18.434L76.93,63.434V26.566L44.999,8.131L13.07,26.565V63.434L13.07,63.434z"></path></g><g id="SvgjsG1244" transform="matrix(2.4630542797616397,0,0,2.4630542797616397,55.66502390387113,-28.965516544793662)" fill="#1a2c5b"><path d="M21.6 40 l-19.84 0 l0 -28.24 l8.92 0 l0 21.12 l10.92 0 l0 7.12 z M42.36 18.72 l-7.16 0 l0 21.28 l-8.92 0 l0 -21.28 l-7.2 0 l0 -6.96 l23.28 0 l0 6.96 z"></path></g></svg></div><div class="hidden h-6 text-2xl font-semibold sm:block">Loc Truong</div></div></a></div><div class="flex items-center leading-5 space-x-4 sm:space-x-6"><a class="hidden sm:block font-medium text-gray-900 dark:text-gray-100" href="/portfolio">Portfolio</a><a class="hidden sm:block font-medium text-gray-900 dark:text-gray-100" href="/blog">Blog</a><a class="hidden sm:block font-medium text-gray-900 dark:text-gray-100" href="/project">Projects</a><button aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="text-gray-900 dark:text-gray-100 h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></button></div></header><main class="mb-auto mt-14"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Youtube database design","datePublished":"2024-04-20T00:00:00.000Z","dateModified":"2024-04-20T00:00:00.000Z","description":"Ddesign a video sharing service like Youtube where users will be able to upload/view/search videos.","image":"/static/images/twitter-card.png","url":"https://tailwind-nextjs-starter-blog.vercel.app/blog/youtube-database-design","author":[{"@type":"Person","name":"Loc Truong"}]}</script><section><div class="fixed bottom-8 right-8 hidden flex-col gap-3 md:hidden"><button aria-label="Scroll To Comment" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"></path></svg></button><button aria-label="Scroll To Top" class="rounded-full bg-gray-200 p-2 text-gray-500 transition-all hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-400 dark:hover:bg-gray-600"><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></button></div><article><div class="xl:divide-y xl:divide-gray-200 xl:dark:divide-gray-700"><header class="pt-16 xl:pb-6"><div class="space-y-1 text-center"><dl class="space-y-10"><div><dt class="sr-only">Published on</dt><dd class="text-base font-medium leading-6 text-gray-500 dark:text-gray-400"><time dateTime="2024-04-20T00:00:00.000Z">Saturday, April 20, 2024</time></dd></div></dl><div><h1 class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-5xl md:leading-14">Youtube database design</h1></div></div></header><div class="grid-rows-[auto_1fr] divide-y divide-gray-200 pb-8 dark:divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0"><dl class="pb-10 pt-6 xl:border-b xl:border-gray-200 xl:pt-11 xl:dark:border-gray-700"><dt class="sr-only">Authors</dt><dd><ul class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8"><li class="flex items-center space-x-2"><img src="/static/images/loctruong/Conmeokhum.gif" alt="avatar" class="h-10 w-10 rounded-full" width="38" height="38"/><dl class="whitespace-nowrap text-sm font-medium leading-5"><dt class="sr-only">Name</dt><dd class="text-gray-900 dark:text-gray-100">Loc Truong</dd><dt class="sr-only">Twitter</dt><dd></dd></dl></li></ul></dd></dl><div class="divide-y divide-gray-200 dark:divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0"><div class="prose max-w-none pb-8 pt-10 dark:prose-invert"><h2 id="1-requirements-and-goals-of-the-system"><a href="#1-requirements-and-goals-of-the-system" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>1. Requirements and Goals of the System</h2><h4 id="functional-requirements"><a href="#functional-requirements" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Functional Requirements:</h4><ol><li>Users should be able to upload videos.</li><li>Users should have ability to share and view videos.</li><li>Users should be able to perform searches based on video titles.</li><li>Service should have starts on videos, e.g likes/dislikes, no. of views, etc.</li><li>Users should be able to add and view comments on videos</li></ol><h4 id="non-functional-requirements"><a href="#non-functional-requirements" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Non-Functional Requirements:</h4><ul><li>System should be highly reliable, any video uploaded should never be lost.</li><li>System should be highly available.</li><li>Users should have a real time experience while watching videos and shoult not feel any lag.</li></ul><h2 id="2-capacity-estimation-and-constraints"><a href="#2-capacity-estimation-and-constraints" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>2. Capacity Estimation and Constraints</h2><p>Assume we have 1 billion total users, 800 million daily active. If on average a user views 5 videos per day, then the total video views per second is:</p><div class="relative"><pre><code>800000000 * 5 / (60 * 60 * 24) ==&gt; ~46000 videos/sec
</code></pre></div><p>Now, let&#x27;s assume our upload:view ratio is 1:200 (For every video upload, we have 200 videos viewed) The number of videos uploaded per second is:</p><div class="relative"><pre><code>46000 / 200 =&gt; 230 videos/sec
</code></pre></div><p><strong>Storage Estimates:</strong> Lets assume 500 hours of video per minute are uploaeded. If on average, one minute of video needs 50MB of storage(videos need to be stored in multiple formats), then total storage is:</p><div class="relative"><pre><code>500 hours * 60 min * 50 MB =&gt; 1500 GB/min OR 25GB/sec
</code></pre></div><p>We are ignoring video compression and replication, which would change our storage estimates.</p><p><strong>Bandwidth Estimates:</strong> 500 videos/min of uploads, and assuming each video takes a bandwidth of 10 MB/min, we would be getting:</p><div class="relative"><pre><code>500 hours * 60 mins * 10 MB ==&gt; 300 GB/min == 5GB/sec
</code></pre></div><p>With upload:view ratio being 1:200, we would need <code>200 * 5GB/sec ==&gt; 1TB/s</code> outgoing bandwidth.</p><h2 id="3-system-apis"><a href="#3-system-apis" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>3. System APIs</h2><p>We can have a RESTful API to expose the functionality of our service.</p><h4 id="uploading-a-video"><a href="#uploading-a-video" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Uploading a video</h4><div class="relative"><pre><code class="language-python">upload_video(
    api_dev_key,  # (string): API developer key of registered account.
    video_title,  # (string): Title of the video.
    video_desc,   # (string): Optional description of video.
    tags,         # (string): Optional tags for the video.
    category_id,  # (string): Category of the video, e.g Song, Docuseries, etc.
    default_language,   # (string): English, Mandarin, Fr, etc.
    recording_details,  # (string): Location where video was recorded.
    video_contents      # (stream): Video to be uploaded.
)

</code></pre></div><p>Returns: (string): A successful upload will return HTTP 202 (request accepted) and once the video encoding is completed the user is notified through email with a link to access the video.</p><h4 id="searching-video"><a href="#searching-video" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Searching video</h4><div class="relative"><pre><code class="language-python">search_video(
    api_dev_key,
    search_query,   # (string): containing the search term
    user_location,  # (string): optional location of user performing search
    maximum_videos_to_return,  # (number): max number of results returned in one request
    page_token      # (string): This token specifies a page in the result set to be returned
)
</code></pre></div><p>Returns: (JSON)</p><p>A JSON containing informaiton about the list of video resources matching the search query. Each resource will have a video title, a video creation date, and a view count.</p><h4 id="streaming-video"><a href="#streaming-video" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Streaming video</h4><div class="relative"><pre><code class="language-python">stream_video(
    api_dev_key, 
    video_id,   # (string): unique ID of the video
    offset,     # (number): time in offset from the beginning of the video. If we support
                # pausing a video from multiple devices, we need to store the offset.
                # This enables the user to pick up watching a video where they left from.
    codec,      # (string): 
    resolution  # (string): Imagine watching a video on TV app, pausing it, then resuming on
                # Netflix mobile app, you&#x27;ll need codec and resolution, as both devices have
                # different resolution and use a different codec.
)
</code></pre></div><p>Returns: (STREAM) A media stream (video chunk) from the given offset.</p><h2 id="4-high-level-design"><a href="#4-high-level-design" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>4. High Level Design</h2><p>At a high-level we would need the following components:</p><ol><li><strong>Processing Queue:</strong>: Each uploaded video will be pushed to a processing queue ot be de-queued later for encoding, thumbnail generation, and storage.</li><li><strong>Encoder:</strong> To encode each uploaded video into multiple formats.</li><li><strong>Thumbnails generator:</strong> To generate thumbnails for each video.</li><li><strong>Video and Thumbnail storage:</strong> To store video and thumbnail files in some distributed file storage.</li><li><strong>User DB:</strong> To store user&#x27;s info e.g name, email, address, etc.</li><li><strong>Video metadata storage:</strong> A metadata DB to store information about videos like title, its file path, uploading user, total views, likes, comments etc.</li></ol><p><img alt="" src="images/hld_youtube.png"/></p><h2 id="5-database-schema"><a href="#5-database-schema" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>5. Database Schema</h2><h4 id="video-metadata-storage---mysql"><a href="#video-metadata-storage---mysql" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Video metadata storage - MySQL</h4><ul><li>VideoID</li><li>Title</li><li>Description</li><li>Size</li><li>Thumbnail</li><li>Uploader/User</li><li>Total likes</li><li>Total dislikes</li><li>Total views</li></ul><p>For each video comment, we nneed to store:</p><ul><li>CommentID</li><li>VideoID</li><li>UserID</li><li>Comment</li><li>CreatedAt</li></ul><h4 id="user-data-storage---mysql"><a href="#user-data-storage---mysql" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>User data storage - MySQL</h4><ul><li>UserID, Name, email, address, age, registration details etc</li></ul><h2 id="6-detailed-component-design"><a href="#6-detailed-component-design" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>6. Detailed Component Design</h2><p>The service will be read-heavy, since more people are viewing than uploading videos. We&#x27;ll focus on building a system that can retrieve videos quickly. We can expect a read:write ratio of 200:1.</p><h4 id="where-would-videos-be-stored"><a href="#where-would-videos-be-stored" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Where would videos be stored?</h4><p>Videos can be stored in a distributed file storage system like HDFS or GlusterFS.</p><h4 id="hows-should-we-efficiently-manage-read-traffic"><a href="#hows-should-we-efficiently-manage-read-traffic" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Hows should we efficiently manage read traffic?</h4><p>We should seperate read from write traffic. We can distribute our read traffic on different servers, since we will have multiple copies of each video. For metadata, we can have a master-slave config where writes go to master first and then gets applied at all the slaves. Such configurations can cause some staleness in data, e.g., when a new video is added, its metadata would be inserted in the master first and before it gets applied at the slave, our slaves would not be able to see it; and therefore it will be returning stale results to the user. This staleness might be acceptable in our system as it would be very short-lived and the user would be able to see the new videos after a few milliseconds.</p><h4 id="where-would-thumbnails-be-stored"><a href="#where-would-thumbnails-be-stored" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Where would thumbnails be stored?</h4><p>There will be a lot more thumbnails than videos. Assume each video has 5 thumbnails, we need to have a very efficient storage system that&#x27;ll serve huge read traffic. Two considerations:</p><ol><li>Thumbnails are small files, max 5KB each.</li><li>Read traffic for thumbnails will be huge compared to videos. Users will be watching one video at a time, but they might be looking at a page that has 20 thumbnails of other videos.</li></ol><p>Let&#x27;s evaluate storing thumbnails on disk. Given the huge number of files, we have to perform a lot of seeks to different locations on the disk to read these files. This is quite inefficient and will result in higher latencies.</p><ul><li><strong><a target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/bigtable/">BigTable</a></strong> can be a reasonable option choice here as it combines multiple files into one block to store on the disk and is very efficient in reading small amounts of data. Both of these are 2 significant requirements of our service. It also autoscales and is easy to replicate and can handle millions of operations per second. Changes to the deployment configuration are also immediate, so there’s no downtime during reconfiguration.</li><li>Keeping hot thumbnails in cache will also help improve latencies and, given that thumbnails are small in size, we can cache a large number of them in memory.</li></ul><h4 id="video-uploads"><a href="#video-uploads" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Video uploads:</h4><p>Since videos could be huge, if while uploading the connection drops, we should support resuming from the same point.</p><h4 id="video-encoding"><a href="#video-encoding" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Video Encoding:</h4><p>Newly uploaded videos are stored on the server and a new task is queued to the processing queue to encode the video into multiple formats. Once completed, the uploader will be notified and the video is made available for viewing/sharing.</p><p><img alt="" src="images/detailed_design_youtube.png"/>             <code>Detailed component design of Youtube</code></p><h2 id="7-metadata-sharding"><a href="#7-metadata-sharding" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>7. Metadata Sharding</h2><p>Read load is extremely high because of huge number of newly uploaded videos. Therefore, we need to distribute our data onto multiple machines that can share read/write operations efficiently. We have a number of strategies when it comes to sharding:</p><h4 id="sharding-based-on-userid"><a href="#sharding-based-on-userid" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Sharding based on UserID:</h4><p>We can try storing all data for a particular user on one server. While storing, we can pass the UserID into a hash function which will map the user to a DB server where we&#x27;ll store their videos metadata. While querying for videos, we can ask our hash function to find the server holding the users&#x27; data and read it from there. To search videos by title we will ahve to query all servers and each server will return a set of videos. A centralized server will then aggregate and rank them before returning them to the user.</p><p>Problems with this approach:</p><ol><li>What if a user becomes popular? There will be a lot of queries on the user&#x27;s server holding their videos; this could create a performance bottleneck.</li><li>Over time, some users can end up storing a lot of videos compared to others. Maintaining a uniform distribution of growing user data is quite tricky.</li></ol><p>To recover from these situations, we can <strong>repartition/redistribute</strong> our data or use <strong>consistent hashing to balance the load between servers</strong></p><h4 id="sharding-based-on-videoid"><a href="#sharding-based-on-videoid" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Sharding based on VideoID:</h4><p>Our hash function will map each videoID to a random server where we&#x27;ll sotre the Video&#x27;s metadata. To find videos of a user, we query all servers adn each server returns a set of videos. A centralized server will aggregate and rank the results before returning them to the user. This approach solves our problem with hot users, but shifts it to popular videos.</p><p>We can further improve our performance by introducing a cache to store hot videos in front of the database servers.</p><h2 id="8-video-deduplication"><a href="#8-video-deduplication" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>8. Video Deduplication</h2><p>With a huge number of users uploading massive amounts of video data, our service will have to deal with widspread video duplication. Duplicate videos often differ in aspect ratios or encodings, can contain overlays or additional borders, or can be excerpts from a longer original video.</p><p>Having duplicate videos can have the following impact on many levels:</p><ol><li>Data Storage: we&#x27;d waste storage by keeping multiple copies of the same video.</li><li>Caching: They&#x27;ll degrade cache efficiency by taking up space tht could be used for unique content.</li><li>Network usage: They&#x27;ll increase data sent over the network to in-network caching systems.</li><li>Energy consumption: Higher storage, inefficient cache and high network usage could result in energy wastage.</li><li>Effect to our user: Duplicate search results, longer video startup times, and interrupted streaming.</li></ol><h4 id="how-do-we-implement-deduplication"><a href="#how-do-we-implement-deduplication" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>How do we implement deduplication?</h4><p>Deduplication should happen when a user is uploading a video as compared to post-processing it to find videos later. Inline deduplication will save us a lot of resources that could be used to encode, transfer, and store the duplicate copy of the video. As soon as any user starts uploading a vidoe, our service can run video matching algorithms to find duplications. Such algorithms include:</p><ul><li><a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Block-matching_algorithm">Block Matching</a>,</li><li><a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Phase_correlation">Phase Correlation</a>, etc.</li></ul><p>If we already have a copy of the video being uploaded, we can either stop the upload and use the existing copy or continue upload and use the newly uploaded video <strong>if it is of higher quality</strong>. We can also divide the video into smaller chunks if the new video is a subpart of the existing video, or vice versa, so that we <strong>only upload the missing parts</strong>.</p><h2 id="9-load-balancing"><a href="#9-load-balancing" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>9. Load Balancing</h2><p>We should use <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Consistent_hashing#targetText=In%20computer%20science%2C%20consistent%20hashing,is%20the%20number%20of%20slots.">Consistent Hashing</a> among cache servers, which will also help in balancing the load between cache servers. It allows us to distribute data across a cluster in such a way that will minimize reorganization when nodes are added or removed. Hence, the caching system will be easier to scale up or scale down. Difference in popularity of videos can lead to uneven load on logical repicas. For instance, if a video becomes popular, the logical replica corresponding to that video will experience more traffic than other servers. This will then translate to uneven load distribution on corresponding physical servers.</p><p>To resolve this issue, <strong>any busy server in one location can redirect a client to a less busy server in the same cache location.</strong> We can use dynamic HTTP redirections for this scenario.</p><p>But the use of redirections also has its drawbacks. Since our service tries to lad balance locally, it leads to multiple other redirections when the host that receives the redirection can&#x27;t serve the video. Also, redirection requires the client to make additional HTTP request; it also leads to higher delays before the video starts playing.</p><h2 id="10-cache"><a href="#10-cache" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>10. Cache</h2><p>Our service should push its content closer to the user using a large number of geographically distributed video cache servers.</p><p>We can introduce a cache for metadata servers to cache hot DB rows. Using Memcache to cache the data and Application servers before hitting the DB ca quickly check if the cache has the desired rows.</p><p>Least Frequently Used(LRU) can be a reasonable cache eviction policy (to remove videos that shouldn&#x27;t be cached) for our system. Under this policy, discard the least recently viewed row first.</p><h4 id="how-can-we-build-more-intelligent-cache"><a href="#how-can-we-build-more-intelligent-cache" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>How can we build more intelligent cache?</h4><p>If we go with the 80-20 rule,</p><blockquote><p>20% of daily read volume comes from videos generating 80% of traffic. This means that certain videos are so popular the majority of people view them.</p></blockquote><p>Therefore, we can try caching 20% of daily read volume of videos and metadata.</p><h2 id="11-content-delivery-networks-cdn"><a href="#11-content-delivery-networks-cdn" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>11. Content Delivery Networks (CDN)</h2><p>A CDN is a system of distributed servers that deliver static media content to a user based in the geographic locations of the user.</p><p>Our service can move popular videos to CDNs:</p><ul><li>CDNs replicate content in multiple places, There a better chance of videos being closer to the user and, with fewer hops, videos will stream from a friendlier network.</li><li>CDN machines make heavy use of caching and can mostly serve videos out of memory.</li></ul><p>Less popular videos that are not cached by CDNs can be served by our servers in various data centers.</p><h2 id="12-fault-tolerance"><a href="#12-fault-tolerance" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>12. Fault Tolerance</h2><p>We should use <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Consistent_hashing">Consistent Hashing</a> to help in replacing dead servers, and distributing load among servers.</p></div><div class="pb-6 pt-6 text-center text-gray-700 dark:text-gray-300" id="comment"><button>Load Comments</button></div></div><footer><div class="divide-gray-200 text-sm font-medium leading-5 dark:divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y"><div class="py-4 xl:py-8"><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Tags</h2><div class="flex flex-wrap"><div class="mr-3 text-sm font-medium uppercase text-primary-500 hover:text-primary-600 dark:hover:text-primary-400 cursor-pointer">system-design</div></div></div><div class="flex justify-between py-4 xl:block xl:space-y-8 xl:py-8"><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Previous Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/top-9-websites-to-learn">9 Best Websites for Free Online Courses with Certificates</a></div></div><div><h2 class="text-xs uppercase tracking-wide text-gray-500 dark:text-gray-400">Next Article</h2><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"><a href="/blog/redux">Redux</a></div></div></div></div><div class="pt-4 xl:pt-8"><div class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400 cursor-pointer">← Back</div></div></footer></div></div></article></section></main><footer><div class="mt-16 flex flex-col items-center"><div class="mb-3 flex space-x-4"><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="mailto:hongloc2206@gmail.com"><span class="sr-only">mail</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://github.com/locionic"><span class="sr-only">github</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></a><a class="text-sm text-gray-500 transition hover:text-gray-600" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/loc-truong-6813a6169/"><span class="sr-only">linkedin</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current text-gray-700 hover:text-primary-500 dark:text-gray-200 dark:hover:text-primary-400 h-6 w-6"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a></div><div class="mb-2 flex space-x-2 text-sm text-gray-500 dark:text-gray-400"><div>Loc Truong</div><div> • </div><div>© 2024</div><div> • </div><a href="/">Portfolio &amp; Blog</a></div></div></footer></div></div></section><script src="/_next/static/chunks/webpack-0d790ec478344941.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/media/2d141e1a38819612-s.p.woff2\",{\"as\":\"font\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/b81ce051c4701a02.css\",{\"as\":\"style\"}]\n0:\"$L3\"\n"])</script><script>self.__next_f.push([1,"4:HL[\"/_next/static/css/5abd8ff7b69db80c.css\",{\"as\":\"style\"}]\n5:HL[\"/_next/static/css/72575e3a678ba3db.css\",{\"as\":\"style\"}]\n"])</script><script>self.__next_f.push([1,"6:I{\"id\":7948,\"chunks\":[\"272:static/chunks/webpack-0d790ec478344941.js\",\"971:static/chunks/fd9d1056-5e8da0e061142b95.js\",\"596:static/chunks/596-a658b434dadd6520.js\"],\"name\":\"default\",\"async\":false}\n8:I{\"id\":6628,\"chunks\":[\"272:static/chunks/webpack-0d790ec478344941.js\",\"971:static/chunks/fd9d1056-5e8da0e061142b95.js\",\"596:static/chunks/596-a658b434dadd6520.js\"],\"name\":\"\",\"async\":false}\n9:I{\"id\":8464,\"chunks\":[\"685:static/chunks/685-46b9c657769ce184.js\",\"590:static/chunks/590-1a7d92d9c32a0341.js\",\"185:static"])</script><script>self.__next_f.push([1,"/chunks/app/layout-96cb6c66d5355158.js\"],\"name\":\"ThemeProviders\",\"async\":false}\na:I{\"id\":3015,\"chunks\":[\"685:static/chunks/685-46b9c657769ce184.js\",\"590:static/chunks/590-1a7d92d9c32a0341.js\",\"185:static/chunks/app/layout-96cb6c66d5355158.js\"],\"name\":\"\",\"async\":false}\nb:I{\"id\":8635,\"chunks\":[\"685:static/chunks/685-46b9c657769ce184.js\",\"590:static/chunks/590-1a7d92d9c32a0341.js\",\"185:static/chunks/app/layout-96cb6c66d5355158.js\"],\"name\":\"\",\"async\":false}\nc:I{\"id\":7767,\"chunks\":[\"272:static/chunks/webpack-0d7"])</script><script>self.__next_f.push([1,"90ec478344941.js\",\"971:static/chunks/fd9d1056-5e8da0e061142b95.js\",\"596:static/chunks/596-a658b434dadd6520.js\"],\"name\":\"default\",\"async\":false}\nd:I{\"id\":7920,\"chunks\":[\"272:static/chunks/webpack-0d790ec478344941.js\",\"971:static/chunks/fd9d1056-5e8da0e061142b95.js\",\"596:static/chunks/596-a658b434dadd6520.js\"],\"name\":\"default\",\"async\":false}\ne:I{\"id\":6685,\"chunks\":[\"685:static/chunks/685-46b9c657769ce184.js\",\"222:static/chunks/222-321b597abced1a69.js\",\"926:static/chunks/926-8a3c4656ff4cde82.js\",\"145:static/ch"])</script><script>self.__next_f.push([1,"unks/145-7b16bd1e42e38916.js\",\"797:static/chunks/app/blog/[...slug]/page-59369ca6ff4b3bec.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"3:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/b81ce051c4701a02.css\",\"precedence\":\"next\"}]],[\"$\",\"$L6\",null,{\"buildId\":\"CiowSHP4soOGGRFrb8GGt\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/youtube-database-design\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"youtube-database-design\",\"c\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":[\\\"youtube-database-design\\\"]}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialHead\":[false,\"$L7\"],\"globalErrorComponent\":\"$8\",\"children\":[null,[\"$\",\"html\",null,{\"lang\":\"en-us\",\"className\":\"__variable_587f35 scroll-smooth\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"76x76\",\"href\":\"/static/favicons/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/static/favicons/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/static/favicons/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/static/favicons/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/static/favicons/safari-pinned-tab.svg\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: light)\",\"content\":\"#fff\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"media\":\"(prefers-color-scheme: dark)\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}],[\"$\",\"body\",null,{\"className\":\"bg-white text-black antialiased dark:bg-gray-950 dark:text-white\",\"children\":[\"$\",\"$L9\",null,{\"children\":[[\"$undefined\",\"$undefined\",\"$undefined\",[\"$\",\"$La\",null,{\"async\":true,\"defer\":true,\"data-website-id\":\"$undefined\",\"src\":\"https://analytics.umami.is/script.js\"}],\"$undefined\"],[\"$\",\"section\",null,{\"children\":[\"$\",\"$Lb\",null,{\"searchConfig\":{\"provider\":\"kbar\",\"kbarConfig\":{\"searchDocumentsPath\":\"search.json\"}},\"children\":[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Ld\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"className\":\"flex flex-col items-start justify-start md:mt-24 md:flex-row md:items-center md:justify-center md:space-x-6\",\"children\":[[\"$\",\"div\",null,{\"className\":\"space-x-2 pb-8 pt-6 md:space-y-5\",\"children\":[\"$\",\"h1\",null,{\"className\":\"text-6xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 md:border-r-2 md:px-6 md:text-8xl md:leading-14\",\"children\":\"404\"}]}],[\"$\",\"div\",null,{\"className\":\"max-w-md\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-4 text-xl font-bold leading-normal md:text-2xl\",\"children\":\"Sorry we couldn't find this page.\"}],[\"$\",\"p\",null,{\"className\":\"mb-8\",\"children\":\"But dont worry, you can find plenty of other things on our homepage.\"}],[\"$\",\"$Le\",null,{\"href\":\"/\",\"className\":\"focus:shadow-outline-blue inline rounded-lg border border-transparent bg-blue-600 px-4 py-2 text-sm font-medium leading-5 text-white shadow transition-colors duration-150 hover:bg-blue-700 focus:outline-none dark:hover:bg-blue-500\",\"children\":\"Back to homepage\"}]]}]]}],\"notFoundStyles\":[],\"childProp\":{\"current\":[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Ld\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$\",\"$Lc\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",[\"slug\",\"youtube-database-design\",\"c\"],\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"template\":[\"$\",\"$Ld\",null,{}],\"templateStyles\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"childProp\":{\"current\":[\"$Lf\",\"$L10\",null],\"segment\":\"__PAGE__?{\\\"slug\\\":[\\\"youtube-database-design\\\"]}\"},\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/5abd8ff7b69db80c.css\",\"precedence\":\"next\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/72575e3a678ba3db.css\",\"precedence\":\"next\"}]]}],\"segment\":[\"slug\",\"youtube-database-design\",\"c\"]},\"styles\":[]}],\"segment\":\"blog\"},\"styles\":[]}]}]}]]}]}]]}],null]}]]\n"])</script><script>self.__next_f.push([1,"11:I{\"id\":7594,\"chunks\":[\"685:static/chunks/685-46b9c657769ce184.js\",\"222:static/chunks/222-321b597abced1a69.js\",\"926:static/chunks/926-8a3c4656ff4cde82.js\",\"145:static/chunks/145-7b16bd1e42e38916.js\",\"797:static/chunks/app/blog/[...slug]/page-59369ca6ff4b3bec.js\"],\"name\":\"\",\"async\":false}\n12:I{\"id\":2529,\"chunks\":[\"685:static/chunks/685-46b9c657769ce184.js\",\"222:static/chunks/222-321b597abced1a69.js\",\"926:static/chunks/926-8a3c4656ff4cde82.js\",\"145:static/chunks/145-7b16bd1e42e38916.js\",\"797:static/chunks/a"])</script><script>self.__next_f.push([1,"pp/blog/[...slug]/page-59369ca6ff4b3bec.js\"],\"name\":\"\",\"async\":false}\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"BlogPosting\\\",\\\"headline\\\":\\\"Youtube database design\\\",\\\"datePublished\\\":\\\"2024-04-20T00:00:00.000Z\\\",\\\"dateModified\\\":\\\"2024-04-20T00:00:00.000Z\\\",\\\"description\\\":\\\"Ddesign a video sharing service like Youtube where users will be able to upload/view/search videos.\\\",\\\"image\\\":\\\"/static/images/twitter-card.png\\\",\\\"url\\\":\\\"https://tailwind-nextjs-starter-blog.vercel.app/blog/youtube-database-design\\\",\\\"author\\\":[{\\\"@type\\\":\\\"Person\\\",\\\"name\\\":\\\"Loc Truong\\\"}]}\"}}],[\"$\",\"$L11\",null,{\"content\":{\"title\":\"Youtube database design\",\"date\":\"2024-04-20T00:00:00.000Z\",\"tags\":[\"system-design\"],\"draft\":false,\"summary\":\"Ddesign a video sharing service like Youtube where users will be able to upload/view/search videos.\",\"type\":\"Blog\",\"readingTime\":{\"text\":\"12 min read\",\"minutes\":11.62,\"time\":697200,\"words\":2324},\"slug\":\"youtube-database-design\",\"path\":\"blog/youtube-database-design\",\"filePath\":\"blog/youtube-database-design.mdx\",\"toc\":[{\"value\":\"1. Requirements and Goals of the System\",\"url\":\"#1-requirements-and-goals-of-the-system\",\"depth\":2},{\"value\":\"Functional Requirements:\",\"url\":\"#functional-requirements\",\"depth\":4},{\"value\":\"Non-Functional Requirements:\",\"url\":\"#non-functional-requirements\",\"depth\":4},{\"value\":\"2. Capacity Estimation and Constraints\",\"url\":\"#2-capacity-estimation-and-constraints\",\"depth\":2},{\"value\":\"3. System APIs\",\"url\":\"#3-system-apis\",\"depth\":2},{\"value\":\"Uploading a video\",\"url\":\"#uploading-a-video\",\"depth\":4},{\"value\":\"Searching video\",\"url\":\"#searching-video\",\"depth\":4},{\"value\":\"Streaming video\",\"url\":\"#streaming-video\",\"depth\":4},{\"value\":\"4. High Level Design\",\"url\":\"#4-high-level-design\",\"depth\":2},{\"value\":\"5. Database Schema\",\"url\":\"#5-database-schema\",\"depth\":2},{\"value\":\"Video metadata storage - MySQL\",\"url\":\"#video-metadata-storage---mysql\",\"depth\":4},{\"value\":\"User data storage - MySQL\",\"url\":\"#user-data-storage---mysql\",\"depth\":4},{\"value\":\"6. Detailed Component Design\",\"url\":\"#6-detailed-component-design\",\"depth\":2},{\"value\":\"Where would videos be stored?\",\"url\":\"#where-would-videos-be-stored\",\"depth\":4},{\"value\":\"Hows should we efficiently manage read traffic?\",\"url\":\"#hows-should-we-efficiently-manage-read-traffic\",\"depth\":4},{\"value\":\"Where would thumbnails be stored?\",\"url\":\"#where-would-thumbnails-be-stored\",\"depth\":4},{\"value\":\"Video uploads:\",\"url\":\"#video-uploads\",\"depth\":4},{\"value\":\"Video Encoding:\",\"url\":\"#video-encoding\",\"depth\":4},{\"value\":\"7. Metadata Sharding\",\"url\":\"#7-metadata-sharding\",\"depth\":2},{\"value\":\"Sharding based on UserID:\",\"url\":\"#sharding-based-on-userid\",\"depth\":4},{\"value\":\"Sharding based on VideoID:\",\"url\":\"#sharding-based-on-videoid\",\"depth\":4},{\"value\":\"8. Video Deduplication\",\"url\":\"#8-video-deduplication\",\"depth\":2},{\"value\":\"How do we implement deduplication?\",\"url\":\"#how-do-we-implement-deduplication\",\"depth\":4},{\"value\":\"9. Load Balancing\",\"url\":\"#9-load-balancing\",\"depth\":2},{\"value\":\"10. Cache\",\"url\":\"#10-cache\",\"depth\":2},{\"value\":\"How can we build more intelligent cache?\",\"url\":\"#how-can-we-build-more-intelligent-cache\",\"depth\":4},{\"value\":\"11. Content Delivery Networks (CDN)\",\"url\":\"#11-content-delivery-networks-cdn\",\"depth\":2},{\"value\":\"12. Fault Tolerance\",\"url\":\"#12-fault-tolerance\",\"depth\":2}],\"structuredData\":{\"@context\":\"https://schema.org\",\"@type\":\"BlogPosting\",\"headline\":\"Youtube database design\",\"datePublished\":\"2024-04-20T00:00:00.000Z\",\"dateModified\":\"2024-04-20T00:00:00.000Z\",\"description\":\"Ddesign a video sharing service like Youtube where users will be able to upload/view/search videos.\",\"image\":\"/static/images/twitter-card.png\",\"url\":\"https://tailwind-nextjs-starter-blog.vercel.app/blog/youtube-database-design\",\"author\":[{\"@type\":\"Person\",\"name\":\"Loc Truong\"}]}},\"authorDetails\":[{\"name\":\"Loc Truong\",\"avatar\":\"/static/images/loctruong/Conmeokhum.gif\",\"occupation\":\"Fullstack Dev / Software Engineer\",\"company\":\"eqchange\",\"email\":\"hongloc2206@gmail.com\",\"linkedin\":\"https://www.linkedin.com/in/loc-truong-6813a6169/\",\"github\":\"https://github.com/locionic\",\"type\":\"Authors\",\"readingTime\":{\"text\":\"1 min read\",\"minutes\":0.085,\"time\":5100,\"words\":17},\"slug\":\"default\",\"path\":\"authors/default\",\"filePath\":\"authors/default.mdx\",\"toc\":[]}],\"next\":{\"title\":\"Redux\",\"date\":\"2024-04-20T00:00:00.000Z\",\"tags\":[\"Redux\"],\"draft\":false,\"summary\":\"3 parts of redux.\",\"type\":\"Blog\",\"readingTime\":{\"text\":\"3 min read\",\"minutes\":2.4,\"time\":144000,\"words\":480},\"slug\":\"redux\",\"path\":\"blog/redux\",\"filePath\":\"blog/redux.mdx\",\"toc\":[{\"value\":\"Introduction To Redux\",\"url\":\"#introduction-to-redux\",\"depth\":1},{\"value\":\"Store\",\"url\":\"#store\",\"depth\":2},{\"value\":\"Actions\",\"url\":\"#actions\",\"depth\":2},{\"value\":\"Reducers\",\"url\":\"#reducers\",\"depth\":2},{\"value\":\"Redux toolkit\",\"url\":\"#redux-toolkit\",\"depth\":1}],\"structuredData\":{\"@context\":\"https://schema.org\",\"@type\":\"BlogPosting\",\"headline\":\"Redux\",\"datePublished\":\"2024-04-20T00:00:00.000Z\",\"dateModified\":\"2024-04-20T00:00:00.000Z\",\"description\":\"3 parts of redux.\",\"image\":\"/static/images/twitter-card.png\",\"url\":\"https://tailwind-nextjs-starter-blog.vercel.app/blog/redux\"}},\"prev\":{\"title\":\"9 Best Websites for Free Online Courses with Certificates\",\"date\":\"2024-04-15T00:00:00.000Z\",\"tags\":[\"Certificate\",\"Course\"],\"draft\":false,\"summary\":\"Free online courses with certificates\",\"type\":\"Blog\",\"readingTime\":{\"text\":\"2 min read\",\"minutes\":1.87,\"time\":112200,\"words\":374},\"slug\":\"top-9-websites-to-learn\",\"path\":\"blog/top-9-websites-to-learn\",\"filePath\":\"blog/top-9-websites-to-learn.mdx\",\"toc\":[{\"value\":\"1. LinkedIn formerly Lynda (Lynda.com)\",\"url\":\"#1-linkedin-formerly-lynda-lyndacom\",\"depth\":1},{\"value\":\"2. Alison\",\"url\":\"#2-alison\",\"depth\":1},{\"value\":\"3. Microsoft Learning\",\"url\":\"#3-microsoft-learning\",\"depth\":1},{\"value\":\"4. Udemy\",\"url\":\"#4-udemy\",\"depth\":1},{\"value\":\"5. Oxford Home Study\",\"url\":\"#5-oxford-home-study\",\"depth\":1},{\"value\":\"6. Open Learning\",\"url\":\"#6-open-learning\",\"depth\":1},{\"value\":\"7. Pluralsight\",\"url\":\"#7-pluralsight\",\"depth\":1},{\"value\":\"8. Free Code Camp\",\"url\":\"#8-free-code-camp\",\"depth\":1},{\"value\":\"9. Google Digital Garage\",\"url\":\"#9-google-digital-garage\",\"depth\":1}],\"structuredData\":{\"@context\":\"https://schema.org\",\"@type\":\"BlogPosting\",\"headline\":\"9 Best Websites for Free Online Courses with Certificates\",\"datePublished\":\"2024-04-15T00:00:00.000Z\",\"dateModified\":\"2024-04-15T00:00:00.000Z\",\"description\":\"Free online courses with certificates\",\"image\":\"/static/images/twitter-card.png\",\"url\":\"https://tailwind-nextjs-starter-blog.vercel.app/blog/top-9-websites-to-learn\"}},\"children\":[[\"$\",\"h2\",null,{\"id\":\"1-requirements-and-goals-of-the-system\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#1-requirements-and-goals-of-the-system\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"1. Requirements and Goals of the System\"]}],[\"$\",\"h4\",null,{\"id\":\"functional-requirements\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#functional-requirements\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Functional Requirements:\"]}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Users should be able to upload videos.\"}],[\"$\",\"li\",null,{\"children\":\"Users should have ability to share and view videos.\"}],[\"$\",\"li\",null,{\"children\":\"Users should be able to perform searches based on video titles.\"}],[\"$\",\"li\",null,{\"children\":\"Service should have starts on videos, e.g likes/dislikes, no. of views, etc.\"}],[\"$\",\"li\",null,{\"children\":\"Users should be able to add and view comments on videos\"}]]}],[\"$\",\"h4\",null,{\"id\":\"non-functional-requirements\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#non-functional-requirements\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Non-Functional Requirements:\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"System should be highly reliable, any video uploaded should never be lost.\"}],[\"$\",\"li\",null,{\"children\":\"System should be highly available.\"}],[\"$\",\"li\",null,{\"children\":\"Users should have a real time experience while watching videos and shoult not feel any lag.\"}]]}],[\"$\",\"h2\",null,{\"id\":\"2-capacity-estimation-and-constraints\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#2-capacity-estimation-and-constraints\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"2. Capacity Estimation and Constraints\"]}],[\"$\",\"p\",null,{\"children\":\"Assume we have 1 billion total users, 800 million daily active. If on average a user views 5 videos per day, then the total video views per second is:\"}],[\"$\",\"$L12\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"800000000 * 5 / (60 * 60 * 24) ==\u003e ~46000 videos/sec\\n\"}]}],[\"$\",\"p\",null,{\"children\":\"Now, let's assume our upload:view ratio is 1:200 (For every video upload, we have 200 videos viewed) The number of videos uploaded per second is:\"}],[\"$\",\"$L12\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"46000 / 200 =\u003e 230 videos/sec\\n\"}]}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Storage Estimates:\"}],\" Lets assume 500 hours of video per minute are uploaeded. If on average, one minute of video needs 50MB of storage(videos need to be stored in multiple formats), then total storage is:\"]}],[\"$\",\"$L12\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"500 hours * 60 min * 50 MB =\u003e 1500 GB/min OR 25GB/sec\\n\"}]}],[\"$\",\"p\",null,{\"children\":\"We are ignoring video compression and replication, which would change our storage estimates.\"}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Bandwidth Estimates:\"}],\" 500 videos/min of uploads, and assuming each video takes a bandwidth of 10 MB/min, we would be getting:\"]}],[\"$\",\"$L12\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"500 hours * 60 mins * 10 MB ==\u003e 300 GB/min == 5GB/sec\\n\"}]}],[\"$\",\"p\",null,{\"children\":[\"With upload:view ratio being 1:200, we would need \",[\"$\",\"code\",null,{\"children\":\"200 * 5GB/sec ==\u003e 1TB/s\"}],\" outgoing bandwidth.\"]}],[\"$\",\"h2\",null,{\"id\":\"3-system-apis\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#3-system-apis\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"3. System APIs\"]}],[\"$\",\"p\",null,{\"children\":\"We can have a RESTful API to expose the functionality of our service.\"}],[\"$\",\"h4\",null,{\"id\":\"uploading-a-video\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#uploading-a-video\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Uploading a video\"]}],[\"$\",\"$L12\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-python\",\"children\":\"upload_video(\\n    api_dev_key,  # (string): API developer key of registered account.\\n    video_title,  # (string): Title of the video.\\n    video_desc,   # (string): Optional description of video.\\n    tags,         # (string): Optional tags for the video.\\n    category_id,  # (string): Category of the video, e.g Song, Docuseries, etc.\\n    default_language,   # (string): English, Mandarin, Fr, etc.\\n    recording_details,  # (string): Location where video was recorded.\\n    video_contents      # (stream): Video to be uploaded.\\n)\\n\\n\"}]}],[\"$\",\"p\",null,{\"children\":\"Returns: (string): A successful upload will return HTTP 202 (request accepted) and once the video encoding is completed the user is notified through email with a link to access the video.\"}],[\"$\",\"h4\",null,{\"id\":\"searching-video\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#searching-video\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Searching video\"]}],[\"$\",\"$L12\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-python\",\"children\":\"search_video(\\n    api_dev_key,\\n    search_query,   # (string): containing the search term\\n    user_location,  # (string): optional location of user performing search\\n    maximum_videos_to_return,  # (number): max number of results returned in one request\\n    page_token      # (string): This token specifies a page in the result set to be returned\\n)\\n\"}]}],[\"$\",\"p\",null,{\"children\":\"Returns: (JSON)\"}],[\"$\",\"p\",null,{\"children\":\"A JSON containing informaiton about the list of video resources matching the search query. Each resource will have a video title, a video creation date, and a view count.\"}],[\"$\",\"h4\",null,{\"id\":\"streaming-video\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#streaming-video\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Streaming video\"]}],[\"$\",\"$L12\",null,{\"children\":[\"$\",\"code\",null,{\"className\":\"language-python\",\"children\":\"stream_video(\\n    api_dev_key, \\n    video_id,   # (string): unique ID of the video\\n    offset,     # (number): time in offset from the beginning of the video. If we support\\n                # pausing a video from multiple devices, we need to store the offset.\\n                # This enables the user to pick up watching a video where they left from.\\n    codec,      # (string): \\n    resolution  # (string): Imagine watching a video on TV app, pausing it, then resuming on\\n                # Netflix mobile app, you'll need codec and resolution, as both devices have\\n                # different resolution and use a different codec.\\n)\\n\"}]}],[\"$\",\"p\",null,{\"children\":\"Returns: (STREAM) A media stream (video chunk) from the given offset.\"}],[\"$\",\"h2\",null,{\"id\":\"4-high-level-design\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#4-high-level-design\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"4. High Level Design\"]}],[\"$\",\"p\",null,{\"children\":\"At a high-level we would need the following components:\"}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Processing Queue:\"}],\": Each uploaded video will be pushed to a processing queue ot be de-queued later for encoding, thumbnail generation, and storage.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Encoder:\"}],\" To encode each uploaded video into multiple formats.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Thumbnails generator:\"}],\" To generate thumbnails for each video.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Video and Thumbnail storage:\"}],\" To store video and thumbnail files in some distributed file storage.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"User DB:\"}],\" To store user's info e.g name, email, address, etc.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Video metadata storage:\"}],\" A metadata DB to store information about videos like title, its file path, uploading user, total views, likes, comments etc.\"]}]]}],[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"alt\":\"\",\"src\":\"images/hld_youtube.png\"}]}],[\"$\",\"h2\",null,{\"id\":\"5-database-schema\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#5-database-schema\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"5. Database Schema\"]}],[\"$\",\"h4\",null,{\"id\":\"video-metadata-storage---mysql\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#video-metadata-storage---mysql\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Video metadata storage - MySQL\"]}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"VideoID\"}],[\"$\",\"li\",null,{\"children\":\"Title\"}],[\"$\",\"li\",null,{\"children\":\"Description\"}],[\"$\",\"li\",null,{\"children\":\"Size\"}],[\"$\",\"li\",null,{\"children\":\"Thumbnail\"}],[\"$\",\"li\",null,{\"children\":\"Uploader/User\"}],[\"$\",\"li\",null,{\"children\":\"Total likes\"}],[\"$\",\"li\",null,{\"children\":\"Total dislikes\"}],[\"$\",\"li\",null,{\"children\":\"Total views\"}]]}],[\"$\",\"p\",null,{\"children\":\"For each video comment, we nneed to store:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"CommentID\"}],[\"$\",\"li\",null,{\"children\":\"VideoID\"}],[\"$\",\"li\",null,{\"children\":\"UserID\"}],[\"$\",\"li\",null,{\"children\":\"Comment\"}],[\"$\",\"li\",null,{\"children\":\"CreatedAt\"}]]}],[\"$\",\"h4\",null,{\"id\":\"user-data-storage---mysql\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#user-data-storage---mysql\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"User data storage - MySQL\"]}],[\"$\",\"ul\",null,{\"children\":[\"$\",\"li\",null,{\"children\":\"UserID, Name, email, address, age, registration details etc\"}]}],[\"$\",\"h2\",null,{\"id\":\"6-detailed-component-design\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#6-detailed-component-design\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"6. Detailed Component Design\"]}],[\"$\",\"p\",null,{\"children\":\"The service will be read-heavy, since more people are viewing than uploading videos. We'll focus on building a system that can retrieve videos quickly. We can expect a read:write ratio of 200:1.\"}],[\"$\",\"h4\",null,{\"id\":\"where-would-videos-be-stored\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#where-would-videos-be-stored\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Where would videos be stored?\"]}],[\"$\",\"p\",null,{\"children\":\"Videos can be stored in a distributed file storage system like HDFS or GlusterFS.\"}],[\"$\",\"h4\",null,{\"id\":\"hows-should-we-efficiently-manage-read-traffic\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#hows-should-we-efficiently-manage-read-traffic\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Hows should we efficiently manage read traffic?\"]}],[\"$\",\"p\",null,{\"children\":\"We should seperate read from write traffic. We can distribute our read traffic on different servers, since we will have multiple copies of each video. For metadata, we can have a master-slave config where writes go to master first and then gets applied at all the slaves. Such configurations can cause some staleness in data, e.g., when a new video is added, its metadata would be inserted in the master first and before it gets applied at the slave, our slaves would not be able to see it; and therefore it will be returning stale results to the user. This staleness might be acceptable in our system as it would be very short-lived and the user would be able to see the new videos after a few milliseconds.\"}],[\"$\",\"h4\",null,{\"id\":\"where-would-thumbnails-be-stored\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#where-would-thumbnails-be-stored\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Where would thumbnails be stored?\"]}],[\"$\",\"p\",null,{\"children\":\"There will be a lot more thumbnails than videos. Assume each video has 5 thumbnails, we need to have a very efficient storage system that'll serve huge read traffic. Two considerations:\"}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Thumbnails are small files, max 5KB each.\"}],[\"$\",\"li\",null,{\"children\":\"Read traffic for thumbnails will be huge compared to videos. Users will be watching one video at a time, but they might be looking at a page that has 20 thumbnails of other videos.\"}]]}],[\"$\",\"p\",null,{\"children\":\"Let's evaluate storing thumbnails on disk. Given the huge number of files, we have to perform a lot of seeks to different locations on the disk to read these files. This is quite inefficient and will result in higher latencies.\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://cloud.google.com/bigtable/\",\"children\":\"BigTable\"}]}],\" can be a reasonable option choice here as it combines multiple files into one block to store on the disk and is very efficient in reading small amounts of data. Both of these are 2 significant requirements of our service. It also autoscales and is easy to replicate and can handle millions of operations per second. Changes to the deployment configuration are also immediate, so there’s no downtime during reconfiguration.\"]}],[\"$\",\"li\",null,{\"children\":\"Keeping hot thumbnails in cache will also help improve latencies and, given that thumbnails are small in size, we can cache a large number of them in memory.\"}]]}],[\"$\",\"h4\",null,{\"id\":\"video-uploads\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#video-uploads\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Video uploads:\"]}],[\"$\",\"p\",null,{\"children\":\"Since videos could be huge, if while uploading the connection drops, we should support resuming from the same point.\"}],[\"$\",\"h4\",null,{\"id\":\"video-encoding\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#video-encoding\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Video Encoding:\"]}],[\"$\",\"p\",null,{\"children\":\"Newly uploaded videos are stored on the server and a new task is queued to the processing queue to encode the video into multiple formats. Once completed, the uploader will be notified and the video is made available for viewing/sharing.\"}],[\"$\",\"p\",null,{\"children\":[[\"$\",\"img\",null,{\"alt\":\"\",\"src\":\"images/detailed_design_youtube.png\"}],\"             \",[\"$\",\"code\",null,{\"children\":\"Detailed component design of Youtube\"}]]}],[\"$\",\"h2\",null,{\"id\":\"7-metadata-sharding\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#7-metadata-sharding\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"7. Metadata Sharding\"]}],[\"$\",\"p\",null,{\"children\":\"Read load is extremely high because of huge number of newly uploaded videos. Therefore, we need to distribute our data onto multiple machines that can share read/write operations efficiently. We have a number of strategies when it comes to sharding:\"}],[\"$\",\"h4\",null,{\"id\":\"sharding-based-on-userid\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#sharding-based-on-userid\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Sharding based on UserID:\"]}],[\"$\",\"p\",null,{\"children\":\"We can try storing all data for a particular user on one server. While storing, we can pass the UserID into a hash function which will map the user to a DB server where we'll store their videos metadata. While querying for videos, we can ask our hash function to find the server holding the users' data and read it from there. To search videos by title we will ahve to query all servers and each server will return a set of videos. A centralized server will then aggregate and rank them before returning them to the user.\"}],[\"$\",\"p\",null,{\"children\":\"Problems with this approach:\"}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"What if a user becomes popular? There will be a lot of queries on the user's server holding their videos; this could create a performance bottleneck.\"}],[\"$\",\"li\",null,{\"children\":\"Over time, some users can end up storing a lot of videos compared to others. Maintaining a uniform distribution of growing user data is quite tricky.\"}]]}],[\"$\",\"p\",null,{\"children\":[\"To recover from these situations, we can \",[\"$\",\"strong\",null,{\"children\":\"repartition/redistribute\"}],\" our data or use \",[\"$\",\"strong\",null,{\"children\":\"consistent hashing to balance the load between servers\"}]]}],[\"$\",\"h4\",null,{\"id\":\"sharding-based-on-videoid\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#sharding-based-on-videoid\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"Sharding based on VideoID:\"]}],[\"$\",\"p\",null,{\"children\":\"Our hash function will map each videoID to a random server where we'll sotre the Video's metadata. To find videos of a user, we query all servers adn each server returns a set of videos. A centralized server will aggregate and rank the results before returning them to the user. This approach solves our problem with hot users, but shifts it to popular videos.\"}],[\"$\",\"p\",null,{\"children\":\"We can further improve our performance by introducing a cache to store hot videos in front of the database servers.\"}],[\"$\",\"h2\",null,{\"id\":\"8-video-deduplication\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#8-video-deduplication\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"8. Video Deduplication\"]}],[\"$\",\"p\",null,{\"children\":\"With a huge number of users uploading massive amounts of video data, our service will have to deal with widspread video duplication. Duplicate videos often differ in aspect ratios or encodings, can contain overlays or additional borders, or can be excerpts from a longer original video.\"}],[\"$\",\"p\",null,{\"children\":\"Having duplicate videos can have the following impact on many levels:\"}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"Data Storage: we'd waste storage by keeping multiple copies of the same video.\"}],[\"$\",\"li\",null,{\"children\":\"Caching: They'll degrade cache efficiency by taking up space tht could be used for unique content.\"}],[\"$\",\"li\",null,{\"children\":\"Network usage: They'll increase data sent over the network to in-network caching systems.\"}],[\"$\",\"li\",null,{\"children\":\"Energy consumption: Higher storage, inefficient cache and high network usage could result in energy wastage.\"}],[\"$\",\"li\",null,{\"children\":\"Effect to our user: Duplicate search results, longer video startup times, and interrupted streaming.\"}]]}],[\"$\",\"h4\",null,{\"id\":\"how-do-we-implement-deduplication\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#how-do-we-implement-deduplication\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"How do we implement deduplication?\"]}],[\"$\",\"p\",null,{\"children\":\"Deduplication should happen when a user is uploading a video as compared to post-processing it to find videos later. Inline deduplication will save us a lot of resources that could be used to encode, transfer, and store the duplicate copy of the video. As soon as any user starts uploading a vidoe, our service can run video matching algorithms to find duplications. Such algorithms include:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://en.wikipedia.org/wiki/Block-matching_algorithm\",\"children\":\"Block Matching\"}],\",\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://en.wikipedia.org/wiki/Phase_correlation\",\"children\":\"Phase Correlation\"}],\", etc.\"]}]]}],[\"$\",\"p\",null,{\"children\":[\"If we already have a copy of the video being uploaded, we can either stop the upload and use the existing copy or continue upload and use the newly uploaded video \",[\"$\",\"strong\",null,{\"children\":\"if it is of higher quality\"}],\". We can also divide the video into smaller chunks if the new video is a subpart of the existing video, or vice versa, so that we \",[\"$\",\"strong\",null,{\"children\":\"only upload the missing parts\"}],\".\"]}],[\"$\",\"h2\",null,{\"id\":\"9-load-balancing\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#9-load-balancing\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"9. Load Balancing\"]}],[\"$\",\"p\",null,{\"children\":[\"We should use \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://en.wikipedia.org/wiki/Consistent_hashing#targetText=In%20computer%20science%2C%20consistent%20hashing,is%20the%20number%20of%20slots.\",\"children\":\"Consistent Hashing\"}],\" among cache servers, which will also help in balancing the load between cache servers. It allows us to distribute data across a cluster in such a way that will minimize reorganization when nodes are added or removed. Hence, the caching system will be easier to scale up or scale down. Difference in popularity of videos can lead to uneven load on logical repicas. For instance, if a video becomes popular, the logical replica corresponding to that video will experience more traffic than other servers. This will then translate to uneven load distribution on corresponding physical servers.\"]}],[\"$\",\"p\",null,{\"children\":[\"To resolve this issue, \",[\"$\",\"strong\",null,{\"children\":\"any busy server in one location can redirect a client to a less busy server in the same cache location.\"}],\" We can use dynamic HTTP redirections for this scenario.\"]}],[\"$\",\"p\",null,{\"children\":\"But the use of redirections also has its drawbacks. Since our service tries to lad balance locally, it leads to multiple other redirections when the host that receives the redirection can't serve the video. Also, redirection requires the client to make additional HTTP request; it also leads to higher delays before the video starts playing.\"}],[\"$\",\"h2\",null,{\"id\":\"10-cache\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#10-cache\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"10. Cache\"]}],[\"$\",\"p\",null,{\"children\":\"Our service should push its content closer to the user using a large number of geographically distributed video cache servers.\"}],[\"$\",\"p\",null,{\"children\":\"We can introduce a cache for metadata servers to cache hot DB rows. Using Memcache to cache the data and Application servers before hitting the DB ca quickly check if the cache has the desired rows.\"}],[\"$\",\"p\",null,{\"children\":\"Least Frequently Used(LRU) can be a reasonable cache eviction policy (to remove videos that shouldn't be cached) for our system. Under this policy, discard the least recently viewed row first.\"}],[\"$\",\"h4\",null,{\"id\":\"how-can-we-build-more-intelligent-cache\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#how-can-we-build-more-intelligent-cache\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"How can we build more intelligent cache?\"]}],[\"$\",\"p\",null,{\"children\":\"If we go with the 80-20 rule,\"}],[\"$\",\"blockquote\",null,{\"children\":[\"$\",\"p\",null,{\"children\":\"20% of daily read volume comes from videos generating 80% of traffic. This means that certain videos are so popular the majority of people view them.\"}]}],[\"$\",\"p\",null,{\"children\":\"Therefore, we can try caching 20% of daily read volume of videos and metadata.\"}],[\"$\",\"h2\",null,{\"id\":\"11-content-delivery-networks-cdn\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#11-content-delivery-networks-cdn\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"11. Content Delivery Networks (CDN)\"]}],[\"$\",\"p\",null,{\"children\":\"A CDN is a system of distributed servers that deliver static media content to a user based in the geographic locations of the user.\"}],[\"$\",\"p\",null,{\"children\":\"Our service can move popular videos to CDNs:\"}],[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":\"CDNs replicate content in multiple places, There a better chance of videos being closer to the user and, with fewer hops, videos will stream from a friendlier network.\"}],[\"$\",\"li\",null,{\"children\":\"CDN machines make heavy use of caching and can mostly serve videos out of memory.\"}]]}],[\"$\",\"p\",null,{\"children\":\"Less popular videos that are not cached by CDNs can be served by our servers in various data centers.\"}],[\"$\",\"h2\",null,{\"id\":\"12-fault-tolerance\",\"children\":[[\"$\",\"a\",null,{\"href\":\"#12-fault-tolerance\",\"aria-hidden\":\"true\",\"tabIndex\":\"-1\",\"children\":[\"$\",\"span\",null,{\"className\":\"icon icon-link\"}]}],\"12. Fault Tolerance\"]}],[\"$\",\"p\",null,{\"children\":[\"We should use \",[\"$\",\"a\",null,{\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"href\":\"https://en.wikipedia.org/wiki/Consistent_hashing\",\"children\":\"Consistent Hashing\"}],\" to help in replacing dead servers, and distributing load among servers.\"]}]]}]]\n"])</script><script>self.__next_f.push([1,"7:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Youtube database design | Portfolio \u0026 Blog\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Ddesign a video sharing service like Youtube where users will be able to upload/view/search videos.\"}],[\"$\",\"meta\",\"3\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"4\",{\"name\":\"robots\",\"content\":\"index, follow\"}],[\"$\",\"meta\",\"5\",{\"name\":\"googlebot\",\"content\":\"index, follow, max-video-preview:-1, max-image-preview:large, max-snippet:-1\"}],[\"$\",\"link\",\"6\",{\"rel\":\"canonical\",\"href\":\"https://tailwind-nextjs-starter-blog.vercel.app/blog/youtube-database-design\"}],[\"$\",\"link\",\"7\",{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"https://tailwind-nextjs-starter-blog.vercel.app/feed.xml\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:title\",\"content\":\"Youtube database design\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:description\",\"content\":\"Ddesign a video sharing service like Youtube where users will be able to upload/view/search videos.\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:url\",\"content\":\"https://tailwind-nextjs-starter-blog.vercel.app/blog/youtube-database-design\"}],[\"$\",\"meta\",\"11\",{\"property\":\"og:site_name\",\"content\":\"Portfolio \u0026 Blog\"}],[\"$\",\"meta\",\"12\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"13\",{\"property\":\"og:image\",\"content\":\"https://tailwind-nextjs-starter-blog.vercel.app/static/images/twitter-card.png\"}],[\"$\",\"meta\",\"14\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"15\",{\"property\":\"article:published_time\",\"content\":\"2024-04-20T00:00:00.000Z\"}],[\"$\",\"meta\",\"16\",{\"property\":\"article:modified_time\",\"content\":\"2024-04-20T00:00:00.000Z\"}],[\"$\",\"meta\",\"17\",{\"property\":\"article:author\",\"content\":\"Loc Truong\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"19\",{\"name\":\"twitter:title\",\"content\":\"Youtube database design\"}],[\"$\",\"meta\",\"20\",{\"name\":\"twitter:description\",\"content\":\"Ddesign a video sharing service like Youtube where users will be able to upload/view/search videos.\"}],[\"$\",\"meta\",\"21\",{\"name\":\"twitter:image\",\"content\":\"https://tailwind-nextjs-starter-blog.vercel.app/static/images/twitter-card.png\"}],[\"$\",\"meta\",\"22\",{\"name\":\"next-size-adjust\"}]]\n"])</script><script>self.__next_f.push([1,"f:null\n"])</script></body></html>